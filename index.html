<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Kunjungan Pasien</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .tab-button {
            background: #E5E7EB;
            color: #4B5563;
        }
        .tab-button.active {
            background: #3B82F6;
            color: white;
        }
        .tab-button:hover:not(.active) {
            background: #D1D5DB;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .filter-dropdown {
            position: relative;
        }
        .filter-dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 250px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1000;
            border-radius: 8px;
            margin-top: 4px;
        }
        .filter-dropdown-content.show {
            display: block;
        }
        .filter-option {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .filter-option:hover {
            background-color: #F3F4F6;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .print-area, .print-area * {
                visibility: visible;
            }
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full w-full bg-gradient-to-br from-blue-50 to-green-50">
  <div class="w-full h-full overflow-auto">
   <div class="container-wrapper mx-auto px-2 sm:px-4 py-4 sm:py-8 max-w-full"><!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-green-600 rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
     <h1 id="dashboard-title" class="text-2xl sm:text-3xl font-bold text-white mb-2">Dashboard Kunjungan Pasien</h1>
     <p id="dashboard-subtitle" class="text-sm sm:text-base text-white opacity-90">Analisis Data Kunjungan</p><!-- Tab Navigation -->
     <div class="flex gap-2 mt-4 flex-wrap"><button onclick="switchTab('overview')" id="tab-overview" class="tab-button px-3 sm:px-4 py-2 rounded-lg font-medium transition-all text-sm sm:text-base"> ğŸ“Š Overview </button> <button onclick="switchTab('pelayanan')" id="tab-pelayanan" class="tab-button px-3 sm:px-4 py-2 rounded-lg font-medium transition-all text-sm sm:text-base"> ğŸ¥ Pelayanan </button> <button onclick="switchTab('status')" id="tab-status" class="tab-button px-3 sm:px-4 py-2 rounded-lg font-medium transition-all text-sm sm:text-base"> ğŸ“‹ Status </button> <button onclick="switchTab('analisa')" id="tab-analisa" class="tab-button px-3 sm:px-4 py-2 rounded-lg font-medium transition-all text-sm sm:text-base"> ğŸ“ˆ Analisa </button>
     </div>
    </div><!-- Loading State -->
    <div id="loading-state" class="bg-white rounded-xl shadow-lg p-12 text-center">
     <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
     <p class="text-gray-600">Memuat data dari Google Sheets...</p>
    </div><!-- Error State -->
    <div id="error-state" class="bg-red-50 border border-red-200 rounded-xl p-6 mb-6 hidden">
     <div class="flex items-start">
      <svg class="w-6 h-6 text-red-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <div>
       <h3 class="text-red-800 font-semibold mb-1">Gagal Memuat Data</h3>
       <p id="error-message" class="text-red-700 text-sm"></p>
      </div>
     </div>
    </div><!-- Main Content -->
    <div id="main-content" class="hidden"><!-- Global Filters -->
     <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
      <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-4">Filter Data (Berlaku Untuk Semua Tab)</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4"><!-- Filter Tahun -->
       <div class="filter-dropdown"><label class="block text-sm font-medium text-gray-700 mb-2">Tahun</label> <button onclick="toggleDropdown('tahun')" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-left bg-white flex justify-between items-center"> <span id="label-tahun" class="text-sm sm:text-base">Semua Tahun</span>
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
         </svg></button>
        <div id="dropdown-tahun" class="filter-dropdown-content">
         <div class="filter-option" onclick="selectAllFilter('tahun')"><input type="checkbox" id="check-all-tahun" checked> <label class="cursor-pointer font-medium">Pilih Semua</label>
         </div>
         <div class="border-t border-gray-200"></div>
         <div id="options-tahun"></div>
        </div>
       </div><!-- Filter Bulan -->
       <div class="filter-dropdown"><label class="block text-sm font-medium text-gray-700 mb-2">Bulan</label> <button onclick="toggleDropdown('bulan')" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-left bg-white flex justify-between items-center"> <span id="label-bulan" class="text-sm sm:text-base">Semua Bulan</span>
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
         </svg></button>
        <div id="dropdown-bulan" class="filter-dropdown-content">
         <div class="filter-option" onclick="selectAllFilter('bulan')"><input type="checkbox" id="check-all-bulan" checked> <label class="cursor-pointer font-medium">Pilih Semua</label>
         </div>
         <div class="border-t border-gray-200"></div>
         <div id="options-bulan"></div>
        </div>
       </div><!-- Filter Klinik -->
       <div class="filter-dropdown"><label class="block text-sm font-medium text-gray-700 mb-2">Klinik</label> <button onclick="toggleDropdown('klinik')" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-left bg-white flex justify-between items-center"> <span id="label-klinik" class="text-sm sm:text-base">Semua Klinik</span>
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
         </svg></button>
        <div id="dropdown-klinik" class="filter-dropdown-content">
         <div class="filter-option" onclick="selectAllFilter('klinik')"><input type="checkbox" id="check-all-klinik" checked> <label class="cursor-pointer font-medium">Pilih Semua</label>
         </div>
         <div class="border-t border-gray-200"></div>
         <div id="options-klinik"></div>
        </div>
       </div><!-- Filter Jenis Pelayanan -->
       <div class="filter-dropdown"><label class="block text-sm font-medium text-gray-700 mb-2">Jenis Pelayanan</label> <button onclick="toggleDropdown('pelayanan')" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-left bg-white flex justify-between items-center"> <span id="label-pelayanan" class="text-sm sm:text-base">Semua Pelayanan</span>
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
         </svg></button>
        <div id="dropdown-pelayanan" class="filter-dropdown-content">
         <div class="filter-option" onclick="selectAllFilter('pelayanan')"><input type="checkbox" id="check-all-pelayanan" checked> <label class="cursor-pointer font-medium">Pilih Semua</label>
         </div>
         <div class="border-t border-gray-200"></div>
         <div id="options-pelayanan"></div>
        </div>
       </div><!-- Filter Jenis Kelamin -->
       <div class="filter-dropdown"><label class="block text-sm font-medium text-gray-700 mb-2">Jenis Kelamin</label> <button onclick="toggleDropdown('kelamin')" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-left bg-white flex justify-between items-center"> <span id="label-kelamin" class="text-sm sm:text-base">Semua Gender</span>
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
         </svg></button>
        <div id="dropdown-kelamin" class="filter-dropdown-content">
         <div class="filter-option" onclick="selectAllFilter('kelamin')"><input type="checkbox" id="check-all-kelamin" checked> <label class="cursor-pointer font-medium">Pilih Semua</label>
         </div>
         <div class="border-t border-gray-200"></div>
         <div id="options-kelamin"></div>
        </div>
       </div><!-- Toggle Values & Reset -->
       <div class="flex flex-col gap-2 justify-end"><label class="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" id="toggle-values" class="w-5 h-5 text-blue-600 rounded"> <span class="text-sm font-medium text-gray-700">Tampilkan Angka</span> </label> <button onclick="resetAllFilters()" class="px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors"> ğŸ”„ Reset Filter </button>
       </div>
      </div>
     </div><!-- Tab Content: Overview -->
     <div id="content-overview" class="tab-content active"><!-- KPI Cards -->
      <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4 mb-4 sm:mb-6">
       <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-4 sm:p-5 text-white">
        <div class="flex items-center justify-between mb-2">
         <h3 class="text-xs font-medium opacity-90">Total</h3>
         <svg class="w-6 h-6 sm:w-7 sm:h-7 opacity-80" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
         </svg>
        </div>
        <p id="kpi-total" class="text-xl sm:text-2xl font-bold">0</p>
       </div>
       <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-4 sm:p-5 text-white">
        <div class="flex items-center justify-between mb-2">
         <h3 class="text-xs font-medium opacity-90">Poliklinik</h3>
         <svg class="w-6 h-6 sm:w-7 sm:h-7 opacity-80" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
         </svg>
        </div>
        <p id="kpi-poliklinik" class="text-xl sm:text-2xl font-bold">0</p>
       </div>
       <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-4 sm:p-5 text-white">
        <div class="flex items-center justify-between mb-2">
         <h3 class="text-xs font-medium opacity-90">MCU</h3>
         <svg class="w-6 h-6 sm:w-7 sm:h-7 opacity-80" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
         </svg>
        </div>
        <p id="kpi-mcu" class="text-xl sm:text-2xl font-bold">0</p>
       </div>
       <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl shadow-lg p-4 sm:p-5 text-white">
        <div class="flex items-center justify-between mb-2">
         <h3 class="text-xs font-medium opacity-90">IGD</h3>
         <svg class="w-6 h-6 sm:w-7 sm:h-7 opacity-80" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
         </svg>
        </div>
        <p id="kpi-igd" class="text-xl sm:text-2xl font-bold">0</p>
       </div>
       <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg p-4 sm:p-5 text-white">
        <div class="flex items-center justify-between mb-2">
         <h3 class="text-xs font-medium opacity-90">Rawat Inap</h3>
         <svg class="w-6 h-6 sm:w-7 sm:h-7 opacity-80" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
         </svg>
        </div>
        <p id="kpi-rawat-inap" class="text-xl sm:text-2xl font-bold">0</p>
       </div>
      </div><!-- Charts -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-4 sm:mb-6">
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Tren Kunjungan</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="downloadChart('chart-tren', 'tren_kunjungan')" class="px-3 py-1 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700 transition-colors"> ğŸ“Š PNG </button> <button onclick="exportChartPDF('chart-tren', 'Tren Kunjungan')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700 transition-colors"> ğŸ“„ PDF </button>
         </div>
        </div>
        <canvas id="chart-tren"></canvas>
       </div>
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Top 10 Klinik</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="downloadChart('chart-klinik', 'top_10_klinik')" class="px-3 py-1 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700 transition-colors"> ğŸ“Š PNG </button> <button onclick="exportChartPDF('chart-klinik', 'Top 10 Klinik')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700 transition-colors"> ğŸ“„ PDF </button>
         </div>
        </div>
        <canvas id="chart-klinik"></canvas>
       </div>
      </div><!-- Distribusi Kunjungan Per Jenis Pelayanan -->
      <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
       <h3 class="text-base sm:text-lg font-bold text-gray-800 mb-4">Distribusi Kunjungan Pasien Berdasarkan Jenis Pelayanan</h3>
       <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-4"><!-- Poliklinik -->
        <div class="border border-gray-200 rounded-lg p-4">
         <div class="flex justify-between items-center mb-3">
          <h4 class="text-sm font-semibold text-gray-700">Poliklinik</h4><button onclick="downloadChart('chart-poliklinik', 'poliklinik')" class="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600"> ï¿½ï¿½ï¿½ï¿½ </button>
         </div>
         <canvas id="chart-poliklinik"></canvas>
        </div><!-- MCU -->
        <div class="border border-gray-200 rounded-lg p-4">
         <div class="flex justify-between items-center mb-3">
          <h4 class="text-sm font-semibold text-gray-700">MCU</h4><button onclick="downloadChart('chart-mcu', 'mcu')" class="px-2 py-1 bg-purple-500 text-white text-xs rounded hover:bg-purple-600"> ğŸ“Š </button>
         </div>
         <canvas id="chart-mcu"></canvas>
        </div><!-- IGD -->
        <div class="border border-gray-200 rounded-lg p-4">
         <div class="flex justify-between items-center mb-3">
          <h4 class="text-sm font-semibold text-gray-700">IGD</h4><button onclick="downloadChart('chart-igd', 'igd')" class="px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"> ğŸ“Š </button>
         </div>
         <canvas id="chart-igd"></canvas>
        </div><!-- Rawat Inap -->
        <div class="border border-gray-200 rounded-lg p-4">
         <div class="flex justify-between items-center mb-3">
          <h4 class="text-sm font-semibold text-gray-700">Rawat Inap</h4><button onclick="downloadChart('chart-ri', 'rawat_inap')" class="px-2 py-1 bg-orange-500 text-white text-xs rounded hover:bg-orange-600"> ğŸ“Š </button>
         </div>
         <canvas id="chart-ri"></canvas>
        </div>
       </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-4 sm:mb-6">
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Jenis Kelamin</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="downloadChart('chart-gender', 'jenis_kelamin')" class="px-3 py-1 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700 transition-colors"> ğŸ“Š PNG </button> <button onclick="exportChartPDF('chart-gender', 'Distribusi Jenis Kelamin')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700 transition-colors"> ğŸ“„ PDF </button>
         </div>
        </div>
        <canvas id="chart-gender"></canvas>
       </div>
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Cara Bayar</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="downloadChart('chart-bayar', 'cara_bayar')" class="px-3 py-1 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700 transition-colors"> ğŸ“Š PNG </button> <button onclick="exportChartPDF('chart-bayar', 'Cara Bayar / Jaminan')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700 transition-colors"> ğŸ“„ PDF </button>
         </div>
        </div>
        <canvas id="chart-bayar"></canvas>
       </div>
      </div><!-- Table -->
      <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
       <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
        <h3 class="text-base sm:text-lg font-bold text-gray-800">Rekap Overview</h3>
        <div class="flex gap-2 flex-wrap"><button onclick="exportTableToCSV('overview')" class="px-3 sm:px-4 py-2 bg-green-600 text-white text-xs sm:text-sm rounded-lg hover:bg-green-700 transition-colors"> ğŸ“¥ CSV </button> <button onclick="exportTableToPDF('overview')" class="px-3 sm:px-4 py-2 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700 transition-colors"> ğŸ“„ PDF </button>
        </div>
       </div>
       <div class="overflow-x-auto">
        <table class="w-full text-sm">
         <thead class="bg-gray-50">
          <tr>
           <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kategori</th>
           <th class="px-3 sm:px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
           <th class="px-3 sm:px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">%</th>
          </tr>
         </thead>
         <tbody id="table-overview-body" class="bg-white divide-y divide-gray-200">
         </tbody>
         <tfoot class="bg-gray-100">
          <tr class="font-bold">
           <td class="px-3 sm:px-4 py-3 text-sm text-gray-900">TOTAL</td>
           <td id="total-overview" class="px-3 sm:px-4 py-3 text-sm text-gray-900 text-right">0</td>
           <td class="px-3 sm:px-4 py-3 text-sm text-gray-900 text-right">100%</td>
          </tr>
         </tfoot>
        </table>
       </div>
      </div><!-- Detail Table -->
      <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
       <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
        <h3 class="text-base sm:text-lg font-bold text-gray-800">Data Detail</h3><input type="text" id="search-table" placeholder="Cari..." class="px-4 py-2 border border-gray-300 rounded-lg w-full sm:w-64 text-sm">
       </div>
       <div class="overflow-x-auto">
        <table class="w-full text-sm">
         <thead class="bg-gray-50">
          <tr>
           <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Periode</th>
           <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Klinik</th>
           <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Jenis</th>
           <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Gender</th>
           <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bayar</th>
           <th class="px-3 sm:px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Jumlah</th>
          </tr>
         </thead>
         <tbody id="table-body" class="bg-white divide-y divide-gray-200">
         </tbody>
        </table>
       </div>
       <div class="flex flex-col sm:flex-row justify-between items-center mt-4 gap-2">
        <p id="table-info" class="text-sm text-gray-600">0 data</p>
        <div class="flex gap-2"><button id="btn-prev" class="px-3 sm:px-4 py-2 border rounded-lg text-xs sm:text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"> Prev </button> <button id="btn-next" class="px-3 sm:px-4 py-2 border rounded-lg text-xs sm:text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"> Next </button>
        </div>
       </div>
      </div>
     </div><!-- Tab Pelayanan -->
     <div id="content-pelayanan" class="tab-content">
      <div class="grid grid-cols-1 gap-4 sm:gap-6 mb-4 sm:mb-6">
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Per Jenis Pelayanan</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="toggleChartType('chart-pelayanan-jenis')" class="px-3 py-1 bg-gray-600 text-white text-xs sm:text-sm rounded-lg hover:bg-gray-700" title="Toggle Chart Type"> ğŸ“ˆ Toggle </button> <button onclick="downloadChart('chart-pelayanan-jenis', 'pelayanan_jenis')" class="px-3 py-1 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700"> ğŸ“Š PNG </button> <button onclick="exportChartPDF('chart-pelayanan-jenis', 'Pelayanan Per Jenis')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
         </div>
        </div>
        <canvas id="chart-pelayanan-jenis"></canvas>
       </div>
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Per Klinik (Top 15)</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="toggleChartType('chart-pelayanan-klinik')" class="px-3 py-1 bg-gray-600 text-white text-xs sm:text-sm rounded-lg hover:bg-gray-700" title="Toggle Chart Type"> ğŸ“ˆ Toggle </button> <button onclick="downloadChart('chart-pelayanan-klinik', 'pelayanan_klinik')" class="px-3 py-1 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700"> ğŸ“Š PNG </button> <button onclick="exportChartPDF('chart-pelayanan-klinik', 'Pelayanan Per Klinik')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
         </div>
        </div>
        <canvas id="chart-pelayanan-klinik"></canvas>
       </div>
      </div><!-- Tables -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Tabel Per Jenis</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="exportTableToCSV('pelayanan-jenis')" class="px-3 py-1 bg-green-600 text-white text-xs sm:text-sm rounded-lg hover:bg-green-700"> ğŸ“¥ CSV </button> <button onclick="exportTableToPDF('pelayanan-jenis')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
         </div>
        </div>
        <div class="overflow-x-auto">
         <table class="w-full text-sm">
          <thead class="bg-gray-50">
           <tr>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Jenis</th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">%</th>
           </tr>
          </thead>
          <tbody id="table-pelayanan-jenis-body" class="bg-white divide-y divide-gray-200">
          </tbody>
          <tfoot class="bg-gray-100">
           <tr class="font-bold">
            <td class="px-3 py-2 text-xs">TOTAL</td>
            <td id="total-pelayanan-jenis" class="px-3 py-2 text-xs text-right">0</td>
            <td class="px-3 py-2 text-xs text-right">100%</td>
           </tr>
          </tfoot>
         </table>
        </div>
       </div>
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Tabel Per Klinik</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="exportTableToCSV('pelayanan-klinik')" class="px-3 py-1 bg-green-600 text-white text-xs sm:text-sm rounded-lg hover:bg-green-700"> ğŸ“¥ CSV </button> <button onclick="exportTableToPDF('pelayanan-klinik')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
         </div>
        </div>
        <div class="overflow-x-auto">
         <table class="w-full text-sm">
          <thead class="bg-gray-50">
           <tr>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Klinik</th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">%</th>
           </tr>
          </thead>
          <tbody id="table-pelayanan-klinik-body" class="bg-white divide-y divide-gray-200">
          </tbody>
          <tfoot class="bg-gray-100">
           <tr class="font-bold">
            <td class="px-3 py-2 text-xs">TOTAL</td>
            <td id="total-pelayanan-klinik" class="px-3 py-2 text-xs text-right">0</td>
            <td class="px-3 py-2 text-xs text-right">100%</td>
           </tr>
          </tfoot>
         </table>
        </div>
       </div>
      </div>
     </div><!-- Tab Status -->
     <div id="content-status" class="tab-content">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-4 sm:mb-6">
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Status Cara Bayar</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="downloadChart('chart-status-bayar', 'status_bayar')" class="px-3 py-1 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700"> ğŸ“Š PNG </button> <button onclick="exportChartPDF('chart-status-bayar', 'Status Cara Bayar')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
         </div>
        </div>
        <canvas id="chart-status-bayar"></canvas>
       </div>
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Status Jaminan</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="downloadChart('chart-status-jaminan', 'status_jaminan')" class="px-3 py-1 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700"> ğŸ“Š PNG </button> <button onclick="exportChartPDF('chart-status-jaminan', 'Status Jaminan')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
         </div>
        </div>
        <canvas id="chart-status-jaminan"></canvas>
       </div>
      </div><!-- Tables -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Tabel Cara Bayar</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="exportTableToCSV('status-bayar')" class="px-3 py-1 bg-green-600 text-white text-xs sm:text-sm rounded-lg hover:bg-green-700"> ğŸ“¥ CSV </button> <button onclick="exportTableToPDF('status-bayar')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
         </div>
        </div>
        <div class="overflow-x-auto">
         <table class="w-full text-sm">
          <thead class="bg-gray-50">
           <tr>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Cara Bayar</th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">%</th>
           </tr>
          </thead>
          <tbody id="table-status-bayar-body" class="bg-white divide-y divide-gray-200">
          </tbody>
          <tfoot class="bg-gray-100">
           <tr class="font-bold">
            <td class="px-3 py-2 text-xs">TOTAL</td>
            <td id="total-status-bayar" class="px-3 py-2 text-xs text-right">0</td>
            <td class="px-3 py-2 text-xs text-right">100%</td>
           </tr>
          </tfoot>
         </table>
        </div>
       </div>
       <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
         <h3 class="text-base sm:text-lg font-bold text-gray-800">Tabel Jaminan</h3>
         <div class="flex gap-2 flex-wrap"><button onclick="exportTableToCSV('status-jaminan')" class="px-3 py-1 bg-green-600 text-white text-xs sm:text-sm rounded-lg hover:bg-green-700"> ğŸ“¥ CSV </button> <button onclick="exportTableToPDF('status-jaminan')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
         </div>
        </div>
        <div class="overflow-x-auto">
         <table class="w-full text-sm">
          <thead class="bg-gray-50">
           <tr>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Jaminan</th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">%</th>
           </tr>
          </thead>
          <tbody id="table-status-jaminan-body" class="bg-white divide-y divide-gray-200">
          </tbody>
          <tfoot class="bg-gray-100">
           <tr class="font-bold">
            <td class="px-3 py-2 text-xs">TOTAL</td>
            <td id="total-status-jaminan" class="px-3 py-2 text-xs text-right">0</td>
            <td class="px-3 py-2 text-xs text-right">100%</td>
           </tr>
          </tfoot>
         </table>
        </div>
       </div>
      </div>
     </div><!-- Tab Analisa -->
     <div id="content-analisa" class="tab-content">
      <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
       <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
        <h3 class="text-base sm:text-lg font-bold text-gray-800">Perbandingan Multi-Tahun</h3>
        <div class="flex gap-2 flex-wrap"><button onclick="downloadChart('chart-analisa', 'analisa_multi_tahun')" class="px-3 py-1 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700"> ï¿½ï¿½ï¿½ï¿½ï¿½ PNG </button> <button onclick="exportChartPDF('chart-analisa', 'Analisa Per Periode')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
        </div>
       </div>
       <canvas id="chart-analisa"></canvas>
      </div>
      <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
       <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
        <h3 class="text-base sm:text-lg font-bold text-gray-800">Tabel Analisa</h3>
        <div class="flex gap-2 flex-wrap"><button onclick="exportTableToCSV('analisa')" class="px-3 py-1 bg-green-600 text-white text-xs sm:text-sm rounded-lg hover:bg-green-700"> ğŸ“¥ CSV </button> <button onclick="exportTableToPDF('analisa')" class="px-3 py-1 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700"> ğŸ“„ PDF </button>
        </div>
       </div>
       <div class="overflow-x-auto">
        <table class="w-full text-sm">
         <thead class="bg-gray-50" id="table-analisa-head">
         </thead>
         <tbody id="table-analisa-body" class="bg-white divide-y divide-gray-200">
         </tbody>
         <tfoot class="bg-gray-100" id="table-analisa-foot">
         </tfoot>
        </table>
       </div>
      </div>
     </div>
    </div><!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-8 py-4">
     <p class="text-center text-sm text-gray-600">Dibuat oleh Tim Pelaporan RSUD Drs. H. Amri Tambunan Â© 2025</p>
    </footer>
   </div>
  </div>
  <script>
        Chart.register(ChartDataLabels);

        // Global variables
        let rawData = [];
        let filteredData = [];
        let charts = {};
        const ITEMS_PER_PAGE = 10;
        let currentPage = 1;
        let searchQuery = '';
        let currentTab = 'overview';

        // Filter states
        let selectedTahun = new Set();
        let selectedBulan = new Set();
        let selectedKlinik = new Set();
        let selectedPelayanan = new Set();
        let selectedKelamin = new Set();

        const monthOrder = {
            'Januari': 1, 'Februari': 2, 'Maret': 3, 'April': 4, 'Mei': 5, 'Juni': 6,
            'Juli': 7, 'Agustus': 8, 'September': 9, 'Oktober': 10, 'November': 11, 'Desember': 12
        };

        const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                            'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

        // Dropdown toggle
        function toggleDropdown(type) {
            const dropdown = document.getElementById('dropdown-' + type);
            const isShow = dropdown.classList.contains('show');
            
            // Close all dropdowns
            document.querySelectorAll('.filter-dropdown-content').forEach(function(d) {
                d.classList.remove('show');
            });
            
            if (!isShow) {
                dropdown.classList.add('show');
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.filter-dropdown')) {
                document.querySelectorAll('.filter-dropdown-content').forEach(function(d) {
                    d.classList.remove('show');
                });
            }
        });

        // Select all filter
        function selectAllFilter(type) {
            const checkAll = document.getElementById('check-all-' + type);
            const isChecked = checkAll.checked;
            
            const checkboxes = document.querySelectorAll('#options-' + type + ' input[type="checkbox"]');
            checkboxes.forEach(function(cb) {
                cb.checked = isChecked;
            });
            
            if (type === 'tahun') {
                if (isChecked) {
                    selectedTahun = new Set([...rawData.map(function(d) { return d.tahun; })].filter(function(t) { return t; }));
                } else {
                    selectedTahun.clear();
                }
            } else if (type === 'bulan') {
                if (isChecked) {
                    selectedBulan = new Set(monthNames);
                } else {
                    selectedBulan.clear();
                }
            } else if (type === 'klinik') {
                if (isChecked) {
                    selectedKlinik = new Set([...rawData.map(function(d) { return d.pelayanan; })].filter(function(p) { return p; }));
                } else {
                    selectedKlinik.clear();
                }
            } else if (type === 'pelayanan') {
                if (isChecked) {
                    selectedPelayanan = new Set([...rawData.map(function(d) { return d.jenisPelayanan; })].filter(function(p) { return p; }));
                } else {
                    selectedPelayanan.clear();
                }
            } else if (type === 'kelamin') {
                if (isChecked) {
                    selectedKelamin = new Set([...rawData.map(function(d) { return d.kelamin; })].filter(function(k) { return k; }));
                } else {
                    selectedKelamin.clear();
                }
            }
            
            updateFilterLabel(type);
            applyFilters();
        }

        // Toggle filter option
        function toggleFilterOption(type, value, event) {
            if (event) {
                event.stopPropagation();
            }
            
            if (type === 'tahun') {
                if (selectedTahun.has(value)) {
                    selectedTahun.delete(value);
                } else {
                    selectedTahun.add(value);
                }
            } else if (type === 'bulan') {
                if (selectedBulan.has(value)) {
                    selectedBulan.delete(value);
                } else {
                    selectedBulan.add(value);
                }
            } else if (type === 'klinik') {
                if (selectedKlinik.has(value)) {
                    selectedKlinik.delete(value);
                } else {
                    selectedKlinik.add(value);
                }
            } else if (type === 'pelayanan') {
                if (selectedPelayanan.has(value)) {
                    selectedPelayanan.delete(value);
                } else {
                    selectedPelayanan.add(value);
                }
            } else if (type === 'kelamin') {
                if (selectedKelamin.has(value)) {
                    selectedKelamin.delete(value);
                } else {
                    selectedKelamin.add(value);
                }
            }
            
            updateFilterLabel(type);
            applyFilters();
        }

        // Update filter label
        function updateFilterLabel(type) {
            let selectedSet, label, allItems;
            
            if (type === 'tahun') {
                selectedSet = selectedTahun;
                allItems = [...new Set(rawData.map(function(d) { return d.tahun; }))].filter(function(t) { return t; }).length;
                label = document.getElementById('label-tahun');
            } else if (type === 'bulan') {
                selectedSet = selectedBulan;
                allItems = monthNames.length;
                label = document.getElementById('label-bulan');
            } else if (type === 'klinik') {
                selectedSet = selectedKlinik;
                allItems = [...new Set(rawData.map(function(d) { return d.pelayanan; }))].filter(function(p) { return p; }).length;
                label = document.getElementById('label-klinik');
            } else if (type === 'pelayanan') {
                selectedSet = selectedPelayanan;
                allItems = [...new Set(rawData.map(function(d) { return d.jenisPelayanan; }))].filter(function(p) { return p; }).length;
                label = document.getElementById('label-pelayanan');
            } else if (type === 'kelamin') {
                selectedSet = selectedKelamin;
                allItems = [...new Set(rawData.map(function(d) { return d.kelamin; }))].filter(function(k) { return k; }).length;
                label = document.getElementById('label-kelamin');
            }
            
            const checkAllId = 'check-all-' + type;
            const checkAll = document.getElementById(checkAllId);
            
            if (selectedSet.size === 0) {
                label.textContent = 'Tidak Ada';
                if (checkAll) checkAll.checked = false;
            } else if (selectedSet.size === allItems) {
                if (type === 'tahun') label.textContent = 'Semua Tahun';
                else if (type === 'bulan') label.textContent = 'Semua Bulan';
                else if (type === 'klinik') label.textContent = 'Semua Klinik';
                else if (type === 'pelayanan') label.textContent = 'Semua Pelayanan';
                else if (type === 'kelamin') label.textContent = 'Semua Gender';
                if (checkAll) checkAll.checked = true;
            } else {
                label.textContent = selectedSet.size + ' dipilih';
                if (checkAll) checkAll.checked = false;
            }
        }

        // Reset all filters
        function resetAllFilters() {
            // Reset semua Set ke default (semua dipilih)
            selectedTahun = new Set([...rawData.map(function(d) { return d.tahun; })].filter(function(t) { return t; }));
            selectedBulan = new Set(monthNames);
            selectedKlinik = new Set([...rawData.map(function(d) { return d.pelayanan; })].filter(function(p) { return p; }));
            selectedPelayanan = new Set([...rawData.map(function(d) { return d.jenisPelayanan; })].filter(function(p) { return p; }));
            selectedKelamin = new Set([...rawData.map(function(d) { return d.kelamin; })].filter(function(k) { return k; }));
            
            // Reset semua checkbox
            const allCheckboxes = document.querySelectorAll('.filter-dropdown input[type="checkbox"]');
            allCheckboxes.forEach(function(cb) {
                cb.checked = true;
            });
            
            // Reset labels
            updateFilterLabel('tahun');
            updateFilterLabel('bulan');
            updateFilterLabel('klinik');
            updateFilterLabel('pelayanan');
            updateFilterLabel('kelamin');
            
            // Reset toggle values
            document.getElementById('toggle-values').checked = false;
            
            // Apply filters
            applyFilters();
        }

        // Fetch data
        async function fetchData() {
            try {
                const sheetId = '1IZkH2U4wGch0qUk1jn4q7CUWfsG6GxtrqD9kBsKN-HY';
                const gid = '198957752';
                const url = 'https://docs.google.com/spreadsheets/d/' + sheetId + '/gviz/tq?tqx=out:json&gid=' + gid;
                
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                
                const rows = json.table.rows;
                const namaBulan = monthNames;
                
                rawData = rows.map(function(row) {
                    const periodeRaw = row.c[0]?.v || '';
                    let bulan = '';
                    let tahunFromPeriode = 0;
                    let periodeText = '';
                    
                    if (typeof periodeRaw === 'string' && periodeRaw.startsWith('Date(')) {
                        const dateMatch = periodeRaw.match(/Date\((\d+),(\d+),(\d+)\)/);
                        if (dateMatch) {
                            const year = parseInt(dateMatch[1]);
                            const monthIndex = parseInt(dateMatch[2]);
                            bulan = namaBulan[monthIndex];
                            tahunFromPeriode = year;
                            periodeText = bulan + ' ' + year;
                        }
                    } else {
                        const periodeParts = periodeRaw.toString().trim().split(/\s+/);
                        bulan = periodeParts[0] || '';
                        tahunFromPeriode = parseInt(periodeParts[1]) || 0;
                        periodeText = periodeRaw.toString().trim().replace(/\s+/g, ' ');
                    }
                    
                    return {
                        periode: periodeText,
                        bulan: bulan,
                        tahunPeriode: tahunFromPeriode,
                        pelayanan: (row.c[1]?.v || '').toString().trim(),
                        jaminan: (row.c[2]?.v || '').toString().trim(),
                        kelamin: (row.c[3]?.v || '').toString().trim(),
                        jumlah: parseInt(row.c[4]?.v || 0),
                        jenisPelayanan: (row.c[5]?.v || '').toString().trim(),
                        caraBayar: (row.c[6]?.v || '').toString().trim(),
                        tahun: parseInt(row.c[7]?.v || 0) || tahunFromPeriode
                    };
                }).filter(function(d) { return d.periode && d.jumlah > 0; });
                
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                
                initializeFilters();
                applyFilters();
            } catch (error) {
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('error-state').classList.remove('hidden');
                document.getElementById('error-message').textContent = 'Error: ' + error.message;
            }
        }

        // Initialize filters
        function initializeFilters() {
            // Tahun
            const tahunSet = [...new Set(rawData.map(function(d) { return d.tahun; }))].filter(function(t) { return t; }).sort(function(a, b) { return b - a; });
            selectedTahun = new Set(tahunSet);
            const optionsTahun = document.getElementById('options-tahun');
            optionsTahun.innerHTML = '';
            tahunSet.forEach(function(tahun) {
                const div = document.createElement('div');
                div.className = 'filter-option';
                div.onclick = function(e) {
                    e.stopPropagation();
                    const checkbox = this.querySelector('input');
                    checkbox.checked = !checkbox.checked;
                    toggleFilterOption('tahun', tahun, e);
                };
                div.innerHTML = '<input type="checkbox" id="check-tahun-' + tahun + '" value="' + tahun + '" checked><label class="cursor-pointer">' + tahun + '</label>';
                optionsTahun.appendChild(div);
            });
            
            // Bulan
            selectedBulan = new Set(monthNames);
            const optionsBulan = document.getElementById('options-bulan');
            optionsBulan.innerHTML = '';
            monthNames.forEach(function(bulan) {
                const div = document.createElement('div');
                div.className = 'filter-option';
                div.onclick = function(e) {
                    e.stopPropagation();
                    const checkbox = this.querySelector('input');
                    checkbox.checked = !checkbox.checked;
                    toggleFilterOption('bulan', bulan, e);
                };
                div.innerHTML = '<input type="checkbox" id="check-bulan-' + bulan + '" value="' + bulan + '" checked><label class="cursor-pointer">' + bulan + '</label>';
                optionsBulan.appendChild(div);
            });
            
            // Klinik
            const klinikSet = [...new Set(rawData.map(function(d) { return d.pelayanan; }))].filter(function(p) { return p; }).sort();
            selectedKlinik = new Set(klinikSet);
            const optionsKlinik = document.getElementById('options-klinik');
            optionsKlinik.innerHTML = '';
            klinikSet.forEach(function(klinik, idx) {
                const div = document.createElement('div');
                div.className = 'filter-option';
                div.onclick = function(e) {
                    e.stopPropagation();
                    const checkbox = this.querySelector('input');
                    checkbox.checked = !checkbox.checked;
                    toggleFilterOption('klinik', klinik, e);
                };
                div.innerHTML = '<input type="checkbox" id="check-klinik-' + idx + '" value="' + klinik + '" checked><label class="cursor-pointer">' + klinik + '</label>';
                optionsKlinik.appendChild(div);
            });
            
            // Pelayanan
            const pelayananSet = [...new Set(rawData.map(function(d) { return d.jenisPelayanan; }))].filter(function(p) { return p; }).sort();
            selectedPelayanan = new Set(pelayananSet);
            const optionsPelayanan = document.getElementById('options-pelayanan');
            optionsPelayanan.innerHTML = '';
            pelayananSet.forEach(function(pelayanan) {
                const div = document.createElement('div');
                div.className = 'filter-option';
                div.onclick = function(e) {
                    e.stopPropagation();
                    const checkbox = this.querySelector('input');
                    checkbox.checked = !checkbox.checked;
                    toggleFilterOption('pelayanan', pelayanan, e);
                };
                div.innerHTML = '<input type="checkbox" id="check-pelayanan-' + pelayanan + '" value="' + pelayanan + '" checked><label class="cursor-pointer">' + pelayanan + '</label>';
                optionsPelayanan.appendChild(div);
            });
            
            // Jenis Kelamin
            const kelaminSet = [...new Set(rawData.map(function(d) { return d.kelamin; }))].filter(function(k) { return k; }).sort();
            selectedKelamin = new Set(kelaminSet);
            const optionsKelamin = document.getElementById('options-kelamin');
            optionsKelamin.innerHTML = '';
            kelaminSet.forEach(function(kelamin) {
                const div = document.createElement('div');
                div.className = 'filter-option';
                div.onclick = function(e) {
                    e.stopPropagation();
                    const checkbox = this.querySelector('input');
                    checkbox.checked = !checkbox.checked;
                    toggleFilterOption('kelamin', kelamin, e);
                };
                div.innerHTML = '<input type="checkbox" id="check-kelamin-' + kelamin + '" value="' + kelamin + '" checked><label class="cursor-pointer">' + kelamin + '</label>';
                optionsKelamin.appendChild(div);
            });
            
            document.getElementById('toggle-values').addEventListener('change', function() {
                updateCurrentTab();
            });
            
            document.getElementById('search-table').addEventListener('input', function(e) {
                searchQuery = e.target.value;
                currentPage = 1;
                updateTable();
            });
            
            document.getElementById('btn-prev').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    updateTable();
                }
            });
            
            document.getElementById('btn-next').addEventListener('click', function() {
                const totalPages = Math.ceil(filteredData.length / ITEMS_PER_PAGE);
                if (currentPage < totalPages) {
                    currentPage++;
                    updateTable();
                }
            });
        }

        // Apply filters
        function applyFilters() {
            filteredData = rawData.filter(function(d) {
                const tahunMatch = selectedTahun.size === 0 || selectedTahun.has(d.tahun);
                const bulanMatch = selectedBulan.size === 0 || selectedBulan.has(d.bulan);
                const klinikMatch = selectedKlinik.size === 0 || selectedKlinik.has(d.pelayanan);
                const pelayananMatch = selectedPelayanan.size === 0 || selectedPelayanan.has(d.jenisPelayanan);
                const kelaminMatch = selectedKelamin.size === 0 || selectedKelamin.has(d.kelamin);
                
                return tahunMatch && bulanMatch && klinikMatch && pelayananMatch && kelaminMatch;
            });
            
            currentPage = 1;
            updateCurrentTab();
        }

        // Switch tab
        function switchTab(tabName) {
            currentTab = tabName;
            
            document.querySelectorAll('.tab-button').forEach(function(btn) {
                btn.classList.remove('active');
            });
            document.getElementById('tab-' + tabName).classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(function(content) {
                content.classList.remove('active');
            });
            document.getElementById('content-' + tabName).classList.add('active');
            
            updateCurrentTab();
        }

        // Update current tab
        function updateCurrentTab() {
            if (currentTab === 'overview') {
                updateOverviewTab();
            } else if (currentTab === 'pelayanan') {
                updatePelayananTab();
            } else if (currentTab === 'status') {
                updateStatusTab();
            } else if (currentTab === 'analisa') {
                updateAnalisaTab();
            }
        }

        // Update Overview Tab
        function updateOverviewTab() {
            updateKPIs();
            updateTrendChart();
            updateKlinikChart();
            updateServiceCharts(); // 4 grafik baru
            updateGenderChart();
            updateBayarChart();
            updateOverviewTable();
            updateTable();
        }

        // Update KPIs
        function updateKPIs() {
            const total = filteredData.reduce(function(sum, d) { return sum + d.jumlah; }, 0);
            const poliklinik = filteredData.filter(function(d) { return d.jenisPelayanan === 'Poliklinik'; }).reduce(function(sum, d) { return sum + d.jumlah; }, 0);
            const mcu = filteredData.filter(function(d) { return d.jenisPelayanan === 'MCU'; }).reduce(function(sum, d) { return sum + d.jumlah; }, 0);
            const igd = filteredData.filter(function(d) { return d.jenisPelayanan === 'IGD'; }).reduce(function(sum, d) { return sum + d.jumlah; }, 0);
            const ri = filteredData.filter(function(d) { return d.jenisPelayanan === 'RI'; }).reduce(function(sum, d) { return sum + d.jumlah; }, 0);
            
            document.getElementById('kpi-total').textContent = total.toLocaleString('id-ID');
            document.getElementById('kpi-poliklinik').textContent = poliklinik.toLocaleString('id-ID');
            document.getElementById('kpi-mcu').textContent = mcu.toLocaleString('id-ID');
            document.getElementById('kpi-igd').textContent = igd.toLocaleString('id-ID');
            document.getElementById('kpi-rawat-inap').textContent = ri.toLocaleString('id-ID');
        }

        // Update Trend Chart
        function updateTrendChart() {
            const ctx = document.getElementById('chart-tren').getContext('2d');
            const showValues = document.getElementById('toggle-values').checked;
            const chartType = chartTypes['chart-tren'] || 'line';
            
            const periodeData = {};
            filteredData.forEach(function(d) {
                periodeData[d.periode] = (periodeData[d.periode] || 0) + d.jumlah;
            });
            
            const sorted = Object.entries(periodeData).sort(function(a, b) {
                const bulanA = a[0].split(' ')[0];
                const tahunA = a[0].split(' ')[1];
                const bulanB = b[0].split(' ')[0];
                const tahunB = b[0].split(' ')[1];
                if (tahunA !== tahunB) return parseInt(tahunA) - parseInt(tahunB);
                return monthOrder[bulanA] - monthOrder[bulanB];
            });
            
            if (charts.tren) charts.tren.destroy();
            
            charts.tren = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: sorted.map(function(item) { return item[0]; }),
                    datasets: [{
                        label: 'Kunjungan',
                        data: sorted.map(function(item) { return item[1]; }),
                        borderColor: '#3B82F6',
                        backgroundColor: chartType === 'line' ? '#3B82F633' : '#3B82F6',
                        tension: 0.4,
                        fill: chartType === 'line'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: showValues,
                            anchor: 'end',
                            align: 'top',
                            font: { weight: 'bold', size: 10 },
                            formatter: function(v) { return v > 0 ? v.toLocaleString('id-ID') : ''; }
                        }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // Update Klinik Chart
        function updateKlinikChart() {
            const ctx = document.getElementById('chart-klinik').getContext('2d');
            const showValues = document.getElementById('toggle-values').checked;
            const chartType = chartTypes['chart-klinik'] || 'bar';
            
            const klinikData = {};
            filteredData.forEach(function(d) {
                klinikData[d.pelayanan] = (klinikData[d.pelayanan] || 0) + d.jumlah;
            });
            
            const sorted = Object.entries(klinikData).sort(function(a, b) { return b[1] - a[1]; }).slice(0, 10);
            
            if (charts.klinik) charts.klinik.destroy();
            
            charts.klinik = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: sorted.map(function(item) { return item[0]; }),
                    datasets: [{
                        label: 'Kunjungan',
                        data: sorted.map(function(item) { return item[1]; }),
                        borderColor: '#10B981',
                        backgroundColor: chartType === 'line' ? '#10B98133' : '#10B981',
                        tension: 0.4,
                        fill: chartType === 'line'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: showValues,
                            anchor: 'end',
                            align: 'top',
                            font: { weight: 'bold', size: 11 },
                            formatter: function(v) { return v.toLocaleString('id-ID'); }
                        }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // Update 4 Service Charts (Poliklinik, MCU, IGD, RI)
        function updateServiceCharts() {
            const showValues = document.getElementById('toggle-values').checked;
            const services = ['Poliklinik', 'MCU', 'IGD', 'RI'];
            const chartIds = ['chart-poliklinik', 'chart-mcu', 'chart-igd', 'chart-ri'];
            const colors = ['#3B82F6', '#8B5CF6', '#EF4444', '#F59E0B'];
            
            services.forEach(function(service, index) {
                const serviceData = filteredData.filter(function(d) {
                    return d.jenisPelayanan === service;
                });
                
                const periodeData = {};
                serviceData.forEach(function(d) {
                    periodeData[d.periode] = (periodeData[d.periode] || 0) + d.jumlah;
                });
                
                // Tampilkan SEMUA data yang tersedia sesuai filter (tidak hanya 6 bulan)
                const sorted = Object.entries(periodeData).sort(function(a, b) {
                    const bulanA = a[0].split(' ')[0];
                    const tahunA = a[0].split(' ')[1];
                    const bulanB = b[0].split(' ')[0];
                    const tahunB = b[0].split(' ')[1];
                    if (tahunA !== tahunB) return parseInt(tahunA) - parseInt(tahunB);
                    return monthOrder[bulanA] - monthOrder[bulanB];
                });
                
                const chartId = chartIds[index];
                const ctx = document.getElementById(chartId).getContext('2d');
                const chartType = chartTypes[chartId] || 'line';
                
                if (charts[chartId]) charts[chartId].destroy();
                
                charts[chartId] = new Chart(ctx, {
                    type: chartType,
                    data: {
                        labels: sorted.map(function(item) { return item[0]; }),
                        datasets: [{
                            label: service,
                            data: sorted.map(function(item) { return item[1]; }),
                            borderColor: colors[index],
                            backgroundColor: chartType === 'line' ? colors[index] + '33' : colors[index],
                            tension: 0.4,
                            fill: chartType === 'line'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false },
                            datalabels: {
                                display: showValues,
                                anchor: 'end',
                                align: 'top',
                                font: { weight: 'bold', size: 9 },
                                formatter: function(v) { return v > 0 ? v.toLocaleString('id-ID') : ''; }
                            }
                        },
                        scales: { 
                            y: { 
                                beginAtZero: true,
                                ticks: { font: { size: 10 } }
                            },
                            x: {
                                ticks: { font: { size: 9 } }
                            }
                        }
                    }
                });
            });
        }

        // Update Gender Chart
        function updateGenderChart() {
            const ctx = document.getElementById('chart-gender').getContext('2d');
            const showValues = document.getElementById('toggle-values').checked;
            
            const genderData = {};
            filteredData.forEach(function(d) {
                genderData[d.kelamin] = (genderData[d.kelamin] || 0) + d.jumlah;
            });
            
            const labels = Object.keys(genderData);
            const data = labels.map(function(k) { return genderData[k]; });
            
            if (charts.gender) charts.gender.destroy();
            
            charts.gender = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ['#3B82F6', '#EC4899', '#8B5CF6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        datalabels: {
                            display: showValues,
                            color: '#fff',
                            font: { weight: 'bold', size: 14 },
                            formatter: function(v) { return v.toLocaleString('id-ID'); }
                        }
                    }
                }
            });
        }

        // Update Bayar Chart
        function updateBayarChart() {
            const ctx = document.getElementById('chart-bayar').getContext('2d');
            const showValues = document.getElementById('toggle-values').checked;
            
            const bayarData = {};
            filteredData.forEach(function(d) {
                bayarData[d.caraBayar] = (bayarData[d.caraBayar] || 0) + d.jumlah;
            });
            
            const sorted = Object.entries(bayarData).sort(function(a, b) { return b[1] - a[1]; });
            
            if (charts.bayar) charts.bayar.destroy();
            
            charts.bayar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(function(item) { return item[0]; }),
                    datasets: [{
                        label: 'Kunjungan',
                        data: sorted.map(function(item) { return item[1]; }),
                        backgroundColor: '#8B5CF6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: showValues,
                            anchor: 'end',
                            align: 'right',
                            font: { weight: 'bold', size: 11 },
                            formatter: function(v) { return v.toLocaleString('id-ID'); }
                        }
                    },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }

        // Update Overview Table
        function updateOverviewTable() {
            const jenisData = {};
            filteredData.forEach(function(d) {
                jenisData[d.jenisPelayanan] = (jenisData[d.jenisPelayanan] || 0) + d.jumlah;
            });
            
            const sorted = Object.entries(jenisData).sort(function(a, b) { return b[1] - a[1]; });
            const total = sorted.reduce(function(sum, item) { return sum + item[1]; }, 0);
            
            const tbody = document.getElementById('table-overview-body');
            tbody.innerHTML = '';
            
            sorted.forEach(function(item) {
                const jenis = item[0];
                const jumlah = item[1];
                const persen = total > 0 ? ((jumlah / total) * 100).toFixed(1) : 0;
                tbody.innerHTML += '<tr class="hover:bg-gray-50"><td class="px-3 sm:px-4 py-3 text-sm text-gray-900">' + jenis + '</td><td class="px-3 sm:px-4 py-3 text-sm text-gray-900 text-right font-medium">' + jumlah.toLocaleString('id-ID') + '</td><td class="px-3 sm:px-4 py-3 text-sm text-gray-900 text-right">' + persen + '%</td></tr>';
            });
            
            document.getElementById('total-overview').textContent = total.toLocaleString('id-ID');
        }

        // Update Table
        function updateTable() {
            const searchLower = searchQuery.toLowerCase();
            let displayData = filteredData;
            
            if (searchQuery) {
                displayData = filteredData.filter(function(d) {
                    return d.periode.toLowerCase().includes(searchLower) ||
                    d.pelayanan.toLowerCase().includes(searchLower) ||
                    d.jenisPelayanan.toLowerCase().includes(searchLower) ||
                    d.kelamin.toLowerCase().includes(searchLower) ||
                    d.caraBayar.toLowerCase().includes(searchLower);
                });
            }
            
            const totalItems = displayData.length;
            const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
            const start = (currentPage - 1) * ITEMS_PER_PAGE;
            const end = start + ITEMS_PER_PAGE;
            const pageData = displayData.slice(start, end);
            
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            
            pageData.forEach(function(d) {
                tbody.innerHTML += '<tr class="hover:bg-gray-50"><td class="px-3 sm:px-4 py-3 text-sm text-gray-900">' + d.periode + '</td><td class="px-3 sm:px-4 py-3 text-sm text-gray-900">' + d.pelayanan + '</td><td class="px-3 sm:px-4 py-3 text-sm text-gray-900">' + d.jenisPelayanan + '</td><td class="px-3 sm:px-4 py-3 text-sm text-gray-900">' + d.kelamin + '</td><td class="px-3 sm:px-4 py-3 text-sm text-gray-900">' + d.caraBayar + '</td><td class="px-3 sm:px-4 py-3 text-sm text-gray-900 text-right font-medium">' + d.jumlah.toLocaleString('id-ID') + '</td></tr>';
            });
            
            document.getElementById('table-info').textContent = totalItems > 0 ? (start + 1) + '-' + Math.min(end, totalItems) + ' dari ' + totalItems + ' data' : '0 data';
            
            document.getElementById('btn-prev').disabled = currentPage === 1;
            document.getElementById('btn-next').disabled = currentPage >= totalPages;
        }

        // Update Pelayanan Tab
        function updatePelayananTab() {
            const showValues = document.getElementById('toggle-values').checked;
            const chartTypeJenis = chartTypes['chart-pelayanan-jenis'] || 'bar';
            const chartTypeKlinik = chartTypes['chart-pelayanan-klinik'] || 'bar';
            
            const jenisData = {};
            filteredData.forEach(function(d) {
                jenisData[d.jenisPelayanan] = (jenisData[d.jenisPelayanan] || 0) + d.jumlah;
            });
            
            const sortedJenis = Object.entries(jenisData).sort(function(a, b) { return b[1] - a[1]; });
            const totalJenis = sortedJenis.reduce(function(sum, item) { return sum + item[1]; }, 0);
            
            const ctxJenis = document.getElementById('chart-pelayanan-jenis').getContext('2d');
            if (charts.pelayananJenis) charts.pelayananJenis.destroy();
            
            charts.pelayananJenis = new Chart(ctxJenis, {
                type: chartTypeJenis,
                data: {
                    labels: sortedJenis.map(function(item) { return item[0]; }),
                    datasets: [{
                        label: 'Kunjungan',
                        data: sortedJenis.map(function(item) { return item[1]; }),
                        borderColor: '#10B981',
                        backgroundColor: chartTypeJenis === 'line' ? '#10B98133' : '#10B981',
                        tension: 0.4,
                        fill: chartTypeJenis === 'line'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: showValues,
                            anchor: 'end',
                            align: 'top',
                            font: { weight: 'bold', size: 12 },
                            formatter: function(v) { return v.toLocaleString('id-ID'); }
                        }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            const klinikData = {};
            filteredData.forEach(function(d) {
                klinikData[d.pelayanan] = (klinikData[d.pelayanan] || 0) + d.jumlah;
            });
            
            const sortedKlinik = Object.entries(klinikData).sort(function(a, b) { return b[1] - a[1]; }).slice(0, 15);
            const totalKlinik = Object.values(klinikData).reduce(function(sum, v) { return sum + v; }, 0);
            
            const ctxKlinik = document.getElementById('chart-pelayanan-klinik').getContext('2d');
            if (charts.pelayananKlinik) charts.pelayananKlinik.destroy();
            
            charts.pelayananKlinik = new Chart(ctxKlinik, {
                type: chartTypeKlinik,
                data: {
                    labels: sortedKlinik.map(function(item) { return item[0]; }),
                    datasets: [{
                        label: 'Kunjungan',
                        data: sortedKlinik.map(function(item) { return item[1]; }),
                        borderColor: '#3B82F6',
                        backgroundColor: chartTypeKlinik === 'line' ? '#3B82F633' : '#3B82F6',
                        tension: 0.4,
                        fill: chartTypeKlinik === 'line'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    indexAxis: chartTypeKlinik === 'bar' ? 'y' : 'x',
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: showValues,
                            anchor: 'end',
                            align: chartTypeKlinik === 'bar' ? 'right' : 'top',
                            font: { weight: 'bold', size: 11 },
                            formatter: function(v) { return v.toLocaleString('id-ID'); }
                        }
                    },
                    scales: { 
                        x: { beginAtZero: true },
                        y: { beginAtZero: true }
                    }
                }
            });
            
            const tbodyJenis = document.getElementById('table-pelayanan-jenis-body');
            tbodyJenis.innerHTML = '';
            sortedJenis.forEach(function(item) {
                const jenis = item[0];
                const jumlah = item[1];
                const persen = ((jumlah / totalJenis) * 100).toFixed(1);
                tbodyJenis.innerHTML += '<tr class="hover:bg-gray-50"><td class="px-3 py-2 text-xs text-gray-900">' + jenis + '</td><td class="px-3 py-2 text-xs text-gray-900 text-right font-medium">' + jumlah.toLocaleString('id-ID') + '</td><td class="px-3 py-2 text-xs text-gray-900 text-right">' + persen + '%</td></tr>';
            });
            document.getElementById('total-pelayanan-jenis').textContent = totalJenis.toLocaleString('id-ID');
            
            const tbodyKlinik = document.getElementById('table-pelayanan-klinik-body');
            tbodyKlinik.innerHTML = '';
            Object.entries(klinikData).sort(function(a, b) { return b[1] - a[1]; }).forEach(function(item) {
                const klinik = item[0];
                const jumlah = item[1];
                const persen = ((jumlah / totalKlinik) * 100).toFixed(1);
                tbodyKlinik.innerHTML += '<tr class="hover:bg-gray-50"><td class="px-3 py-2 text-xs text-gray-900">' + klinik + '</td><td class="px-3 py-2 text-xs text-gray-900 text-right font-medium">' + jumlah.toLocaleString('id-ID') + '</td><td class="px-3 py-2 text-xs text-gray-900 text-right">' + persen + '%</td></tr>';
            });
            document.getElementById('total-pelayanan-klinik').textContent = totalKlinik.toLocaleString('id-ID');
        }

        // Update Status Tab
        function updateStatusTab() {
            const showValues = document.getElementById('toggle-values').checked;
            
            const bayarData = {};
            filteredData.forEach(function(d) {
                bayarData[d.caraBayar] = (bayarData[d.caraBayar] || 0) + d.jumlah;
            });
            
            const sortedBayar = Object.entries(bayarData).sort(function(a, b) { return b[1] - a[1]; });
            const totalBayar = sortedBayar.reduce(function(sum, item) { return sum + item[1]; }, 0);
            
            const ctxBayar = document.getElementById('chart-status-bayar').getContext('2d');
            if (charts.statusBayar) charts.statusBayar.destroy();
            
            charts.statusBayar = new Chart(ctxBayar, {
                type: 'pie',
                data: {
                    labels: sortedBayar.map(function(item) { return item[0]; }),
                    datasets: [{
                        data: sortedBayar.map(function(item) { return item[1]; }),
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        datalabels: {
                            display: showValues,
                            color: '#fff',
                            font: { weight: 'bold', size: 14 },
                            formatter: function(v) { return v.toLocaleString('id-ID'); }
                        }
                    }
                }
            });
            
            const jaminanData = {};
            filteredData.forEach(function(d) {
                jaminanData[d.jaminan] = (jaminanData[d.jaminan] || 0) + d.jumlah;
            });
            
            const sortedJaminan = Object.entries(jaminanData).sort(function(a, b) { return b[1] - a[1]; });
            const totalJaminan = sortedJaminan.reduce(function(sum, item) { return sum + item[1]; }, 0);
            
            const ctxJaminan = document.getElementById('chart-status-jaminan').getContext('2d');
            if (charts.statusJaminan) charts.statusJaminan.destroy();
            
            charts.statusJaminan = new Chart(ctxJaminan, {
                type: 'doughnut',
                data: {
                    labels: sortedJaminan.map(function(item) { return item[0]; }),
                    datasets: [{
                        data: sortedJaminan.map(function(item) { return item[1]; }),
                        backgroundColor: ['#8B5CF6', '#EC4899', '#F59E0B', '#10B981', '#3B82F6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        datalabels: {
                            display: showValues,
                            color: '#fff',
                            font: { weight: 'bold', size: 14 },
                            formatter: function(v) { return v.toLocaleString('id-ID'); }
                        }
                    }
                }
            });
            
            const tbodyBayar = document.getElementById('table-status-bayar-body');
            tbodyBayar.innerHTML = '';
            sortedBayar.forEach(function(item) {
                const cara = item[0];
                const jumlah = item[1];
                const persen = ((jumlah / totalBayar) * 100).toFixed(1);
                tbodyBayar.innerHTML += '<tr class="hover:bg-gray-50"><td class="px-3 py-2 text-xs text-gray-900">' + cara + '</td><td class="px-3 py-2 text-xs text-gray-900 text-right font-medium">' + jumlah.toLocaleString('id-ID') + '</td><td class="px-3 py-2 text-xs text-gray-900 text-right">' + persen + '%</td></tr>';
            });
            document.getElementById('total-status-bayar').textContent = totalBayar.toLocaleString('id-ID');
            
            const tbodyJaminan = document.getElementById('table-status-jaminan-body');
            tbodyJaminan.innerHTML = '';
            sortedJaminan.forEach(function(item) {
                const jaminan = item[0];
                const jumlah = item[1];
                const persen = ((jumlah / totalJaminan) * 100).toFixed(1);
                tbodyJaminan.innerHTML += '<tr class="hover:bg-gray-50"><td class="px-3 py-2 text-xs text-gray-900">' + jaminan + '</td><td class="px-3 py-2 text-xs text-gray-900 text-right font-medium">' + jumlah.toLocaleString('id-ID') + '</td><td class="px-3 py-2 text-xs text-gray-900 text-right">' + persen + '%</td></tr>';
            });
            document.getElementById('total-status-jaminan').textContent = totalJaminan.toLocaleString('id-ID');
        }

        // Update Analisa Tab
        function updateAnalisaTab() {
            const showValues = document.getElementById('toggle-values').checked;
            const chartType = chartTypes['chart-analisa'] || 'line';
            const selectedYears = [...selectedTahun].sort(function(a, b) { return a - b; });
            
            if (selectedYears.length === 0) {
                return;
            }
            
            const yearData = {};
            selectedYears.forEach(function(year) {
                yearData[year] = {};
                monthNames.forEach(function(month) {
                    yearData[year][month] = 0;
                });
            });
            
            filteredData.forEach(function(d) {
                if (selectedYears.includes(d.tahun) && yearData[d.tahun]) {
                    yearData[d.tahun][d.bulan] = (yearData[d.tahun][d.bulan] || 0) + d.jumlah;
                }
            });
            
            const colors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#6366F1', '#14B8A6'];
            const datasets = selectedYears.map(function(year, idx) {
                return {
                    label: year.toString(),
                    data: monthNames.map(function(m) { return yearData[year][m] || 0; }),
                    borderColor: colors[idx % colors.length],
                    backgroundColor: chartType === 'line' ? colors[idx % colors.length] + '33' : colors[idx % colors.length],
                    tension: 0.4,
                    fill: chartType === 'line'
                };
            });
            
            const ctxAnalisa = document.getElementById('chart-analisa').getContext('2d');
            if (charts.analisa) charts.analisa.destroy();
            
            charts.analisa = new Chart(ctxAnalisa, {
                type: chartType,
                data: {
                    labels: monthNames,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        datalabels: {
                            display: showValues,
                            anchor: 'end',
                            align: 'top',
                            font: { weight: 'bold', size: 9 },
                            formatter: function(v) { return v > 0 ? v.toLocaleString('id-ID') : ''; }
                        }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            const thead = document.getElementById('table-analisa-head');
            let theadHTML = '<tr><th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase sticky left-0 bg-gray-50">Bulan</th>';
            selectedYears.forEach(function(year) {
                theadHTML += '<th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">' + year + '</th>';
            });
            theadHTML += '</tr>';
            thead.innerHTML = theadHTML;
            
            const tbody = document.getElementById('table-analisa-body');
            tbody.innerHTML = '';
            monthNames.forEach(function(month) {
                let row = '<tr class="hover:bg-gray-50"><td class="px-3 py-2 text-xs text-gray-900 sticky left-0 bg-white">' + month + '</td>';
                selectedYears.forEach(function(year) {
                    const value = yearData[year][month] || 0;
                    row += '<td class="px-3 py-2 text-xs text-gray-900 text-right font-medium">' + value.toLocaleString('id-ID') + '</td>';
                });
                row += '</tr>';
                tbody.innerHTML += row;
            });
            
            const tfoot = document.getElementById('table-analisa-foot');
            let tfootHTML = '<tr class="font-bold"><td class="px-3 py-2 text-xs text-gray-900 sticky left-0 bg-gray-100">TOTAL</td>';
            selectedYears.forEach(function(year) {
                const total = Object.values(yearData[year]).reduce(function(sum, v) { return sum + v; }, 0);
                tfootHTML += '<td class="px-3 py-2 text-xs text-gray-900 text-right">' + total.toLocaleString('id-ID') + '</td>';
            });
            tfootHTML += '</tr>';
            tfoot.innerHTML = tfootHTML;
        }

        // Download Chart
        function downloadChart(chartId, filename) {
            const canvas = document.getElementById(chartId);
            const url = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = filename + '_' + new Date().getTime() + '.png';
            link.href = url;
            link.click();
        }

        // Export Chart PDF
        function exportChartPDF(chartId, title) {
            const canvas = document.getElementById(chartId);
            const imgData = canvas.toDataURL('image/png');
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>' + title + '</title><style>body { margin: 0; padding: 20px; font-family: Arial, sans-serif; } h2 { text-align: center; margin-bottom: 20px; } img { display: block; margin: 0 auto; max-width: 100%; } @media print { body { padding: 0; } }</style></head><body><h2>' + title + '</h2><img src="' + imgData + '" /><script>window.onload = function() { window.print(); }<\/script></body></html>');
            printWindow.document.close();
        }

        // Export Table CSV
        function exportTableToCSV(type) {
            let csv = [];
            let filename = '';
            
            if (type === 'overview') {
                csv.push(['Kategori', 'Total Kunjungan', 'Persentase']);
                const rows = document.querySelectorAll('#table-overview-body tr');
                rows.forEach(function(row) {
                    const cols = row.querySelectorAll('td');
                    csv.push([cols[0].textContent, cols[1].textContent.replace(/\./g, ''), cols[2].textContent]);
                });
                const total = document.getElementById('total-overview').textContent;
                csv.push(['TOTAL', total.replace(/\./g, ''), '100%']);
                filename = 'rekap_overview.csv';
            } else if (type === 'pelayanan-jenis') {
                csv.push(['Jenis Pelayanan', 'Total Kunjungan', 'Persentase']);
                const rows = document.querySelectorAll('#table-pelayanan-jenis-body tr');
                rows.forEach(function(row) {
                    const cols = row.querySelectorAll('td');
                    csv.push([cols[0].textContent, cols[1].textContent.replace(/\./g, ''), cols[2].textContent]);
                });
                const total = document.getElementById('total-pelayanan-jenis').textContent;
                csv.push(['TOTAL', total.replace(/\./g, ''), '100%']);
                filename = 'pelayanan_per_jenis.csv';
            } else if (type === 'pelayanan-klinik') {
                csv.push(['Klinik', 'Total Kunjungan', 'Persentase']);
                const rows = document.querySelectorAll('#table-pelayanan-klinik-body tr');
                rows.forEach(function(row) {
                    const cols = row.querySelectorAll('td');
                    csv.push([cols[0].textContent, cols[1].textContent.replace(/\./g, ''), cols[2].textContent]);
                });
                const total = document.getElementById('total-pelayanan-klinik').textContent;
                csv.push(['TOTAL', total.replace(/\./g, ''), '100%']);
                filename = 'pelayanan_per_klinik.csv';
            } else if (type === 'status-bayar') {
                csv.push(['Cara Bayar', 'Total Kunjungan', 'Persentase']);
                const rows = document.querySelectorAll('#table-status-bayar-body tr');
                rows.forEach(function(row) {
                    const cols = row.querySelectorAll('td');
                    csv.push([cols[0].textContent, cols[1].textContent.replace(/\./g, ''), cols[2].textContent]);
                });
                const total = document.getElementById('total-status-bayar').textContent;
                csv.push(['TOTAL', total.replace(/\./g, ''), '100%']);
                filename = 'status_cara_bayar.csv';
            } else if (type === 'status-jaminan') {
                csv.push(['Jaminan', 'Total Kunjungan', 'Persentase']);
                const rows = document.querySelectorAll('#table-status-jaminan-body tr');
                rows.forEach(function(row) {
                    const cols = row.querySelectorAll('td');
                    csv.push([cols[0].textContent, cols[1].textContent.replace(/\./g, ''), cols[2].textContent]);
                });
                const total = document.getElementById('total-status-jaminan').textContent;
                csv.push(['TOTAL', total.replace(/\./g, ''), '100%']);
                filename = 'status_jaminan.csv';
            } else if (type === 'analisa') {
                const headers = [];
                document.querySelectorAll('#table-analisa-head th').forEach(function(th) {
                    headers.push(th.textContent);
                });
                csv.push(headers);
                
                const rows = document.querySelectorAll('#table-analisa-body tr');
                rows.forEach(function(row) {
                    const cols = row.querySelectorAll('td');
                    const rowData = [];
                    cols.forEach(function(col) {
                        rowData.push(col.textContent.replace(/\./g, ''));
                    });
                    csv.push(rowData);
                });
                
                const footCols = [];
                document.querySelectorAll('#table-analisa-foot td').forEach(function(td) {
                    footCols.push(td.textContent.replace(/\./g, ''));
                });
                csv.push(footCols);
                
                filename = 'analisa_periode.csv';
            }
            
            const csvContent = csv.map(function(row) { return row.join(','); }).join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // Export Table PDF
        function exportTableToPDF(type) {
            let title = '';
            let tableHTML = '';
            
            if (type === 'overview') {
                title = 'Rekap Data Overview';
                tableHTML = document.getElementById('table-overview-body').parentElement.outerHTML;
            } else if (type === 'pelayanan-jenis') {
                title = 'Rekap Per Jenis Pelayanan';
                tableHTML = document.getElementById('table-pelayanan-jenis-body').parentElement.outerHTML;
            } else if (type === 'pelayanan-klinik') {
                title = 'Rekap Per Klinik';
                tableHTML = document.getElementById('table-pelayanan-klinik-body').parentElement.outerHTML;
            } else if (type === 'status-bayar') {
                title = 'Tabel Status Cara Bayar';
                tableHTML = document.getElementById('table-status-bayar-body').parentElement.outerHTML;
            } else if (type === 'status-jaminan') {
                title = 'Tabel Status Jaminan';
                tableHTML = document.getElementById('table-status-jaminan-body').parentElement.outerHTML;
            } else if (type === 'analisa') {
                title = 'Tabel Analisa Per Bulan';
                tableHTML = '<table border="1" cellpadding="5" cellspacing="0" style="border-collapse:collapse;width:100%;">';
                tableHTML += document.getElementById('table-analisa-head').outerHTML;
                tableHTML += document.getElementById('table-analisa-body').outerHTML;
                tableHTML += document.getElementById('table-analisa-foot').outerHTML;
                tableHTML += '</table>';
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<html><head><title>' + title + '</title><style>body { margin: 0; padding: 20px; font-family: Arial, sans-serif; } h2 { text-align: center; margin-bottom: 20px; } table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid #ddd; padding: 8px; text-align: left; } th { background-color: #f3f4f6; font-weight: bold; } tfoot { background-color: #e5e7eb; font-weight: bold; } @media print { body { padding: 10px; } }</style></head><body><h2>' + title + '</h2>' + tableHTML + '<script>window.onload = function() { window.print(); }<\/script></body></html>');
            printWindow.document.close();
        }

        // Initialize
        fetchData();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b8bdd9b234a3d7d',t:'MTc2NzU0MTU1NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
